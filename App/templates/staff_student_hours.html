{% extends "staff_layout.html" %}

{% block content %}
<div class="container" style="margin-top: 30px; max-width: 1400px; width: 95%;">

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="card-panel {{ 'red lighten-4 red-text text-darken-4' if category == 'error' else 'green lighten-4 green-text text-darken-4' }}">
          {{ msg }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- FILTER BAR -->
  <div class="card blue lighten-4 z-depth-1" style="border-radius: 10px;">
    <div class="card-content" style="padding: 30px;">
      <span class="card-title" style="font-size: 1.7rem; font-weight: 600;">
        View Student Hours
      </span>

      <p class="grey-text text-darken-2" style="margin-bottom: 25px; font-size: 1.1rem;">
        Search or filter students by ID, name, or minimum hours accumulated.
      </p>

      <form method="get" action="{{ url_for('index_views.staff_student_hours_page') }}">
        <div class="row" style="margin-bottom: 0;">
          <div class="col s12 m4">
            <div class="input-field">
              <input id="search_id" name="search_id" type="text" value="{{ search_id }}">
              <label for="search_id" class="active">Search by ID</label>
            </div>
          </div>

          <div class="col s12 m4">
            <div class="input-field">
              <input id="search_name" name="search_name" type="text" value="{{ search_name }}">
              <label for="search_name" class="active">Search by Name</label>
            </div>
          </div>

          <div class="col s12 m4">
            <div class="input-field">
              <input id="min_hours" name="min_hours" type="number" step="0.5" min="0" value="{{ min_hours }}">
              <label for="min_hours" class="active">Minimum Hours</label>
            </div>
          </div>
        </div>

        <div class="row" style="margin-top: 15px;">
          <div class="col s6">
            <button type="submit"
                    class="btn blue darken-2 waves-effect waves-light" style="padding: 0 25px;">
              Apply Filters
            </button>
          </div>
          <div class="col s6 right-align">
            <a href="{{ url_for('index_views.staff_student_hours_page') }}"
               class="btn-flat waves-effect grey-text text-darken-2">
              Clear Filters
            </a>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- STUDENT CARDS -->
  {% if students %}
    {% for student in students %}
      <div class="card blue lighten-4 hoverable z-depth-1"
           style="margin-top: 20px; border-radius: 10px; width: 100%;">
        <div class="card-content"
             style="padding: 25px 32px; font-size: 1.05rem;">
          <div class="row" style="margin-bottom: 0; display: flex; align-items: center;">
            <div class="col s12 m9">
              <p><span class="grey-text text-darken-2">ID:</span> <strong>{{ student.id }}</strong></p>
              <p><span class="grey-text text-darken-2">Name:</span> <strong>{{ student.name }}</strong></p>
              <p><span class="grey-text text-darken-2">Total Hours:</span> <strong>{{ student.hoursAccumulated }} Hours</strong></p>
            </div>

            <div class="col s12 m3 right-align" style="margin-top: 10px;">
              <span class="grey-text text-darken-2">Pending Requests</span>
              <span class="new badge green" data-badge-caption=""
                    style="font-size: 0.9rem; margin-left: 5px;">
                {{ pending_counts.get(student.id, 0) }}
              </span>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="card-panel blue lighten-5">
      <span class="grey-text text-darken-2">
        No students found for the selected filters.
      </span>
    </div>
  {% endif %}

</div>
{% endblock %}
