{% extends "staff_layout.html" %}

{% block styles %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='staff_student_hours.css') }}">
{% endblock %}

{% block content %}
<div class="hours-container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div
          class="card-panel {{ 'red lighten-4 red-text text-darken-4' if category == 'error' else 'green lighten-4 green-text text-darken-4' }}"
        >
          {{ msg }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- FILTER BAR -->
  <div class="card z-depth-1 hours-filter-card">
    <div class="card-content hours-filter-card-content">
      <span class="card-title hours-filter-title">
        View Student Hours
      </span>

      <p class="grey-text text-darken-2 hours-filter-description">
        Search or filter students by ID, name, or minimum hours accumulated.
      </p>

      <form
        method="get"
        action="{{ url_for('staff_views.staff_student_hours_page') }}"
      >
        <div class="row hours-row-tight">
          <div class="col s12 m4">
            <div class="input-field">
              <input
                id="search_id"
                name="search_id"
                type="text"
                value="{{ search_id }}"
              />
              <label for="search_id" class="active">Search by ID</label>
            </div>
          </div>

          <div class="col s12 m4">
            <div class="input-field">
              <input
                id="search_name"
                name="search_name"
                type="text"
                value="{{ search_name }}"
              />
              <label for="search_name" class="active">Search by Name</label>
            </div>
          </div>

          <div class="col s12 m4">
            <div class="input-field">
              <input
                id="min_hours"
                name="min_hours"
                type="number"
                step="0.5"
                min="0"
                value="{{ min_hours }}"
              />
              <label for="min_hours" class="active">Minimum Hours</label>
            </div>
          </div>
        </div>

        <div class="row hours-filter-actions-row">
          <div class="col s12 m6">
            <button
              type="submit"
               class="btn apply-filters-btn waves-effect waves-light"
            >
              Apply Filters
            </button>
          </div>
          <div class="col s12 m6 hours-clear-filters-col">
            <a
              href="{{ url_for('staff_views.staff_student_hours_page') }}"
              class="btn clear-filters-btn waves-effect"
            >
              Clear Filters
            </a>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- STUDENT CARDS -->
  {% if students %}
    {% for student in students %}
      <div class="card hoverable z-depth-1 hours-student-card">
        <div class="card-content hours-student-card-content">
          <div class="row hours-row-tight hours-student-row">
            <div class="col s12 m9">
              <p>
                <span class="grey-text text-darken-2">ID:</span>
                <strong>{{ student.id }}</strong>
              </p>
              <p>
                <span class="grey-text text-darken-2">Name:</span>
                <strong>{{ student.name }}</strong>
              </p>
              <p>
                <span class="grey-text text-darken-2">Total Hours:</span>
                <strong>{{ student.hoursAccumulated }} Hours</strong>
              </p>
            </div>

            <div class="col s12 m3 hours-pending-col">
              <span class="grey-text text-darken-2 hours-pending-label">
                Pending Requests
              </span>
              <span
                class="new badge green hours-pending-badge"
                data-badge-caption=""
              >
                {{ pending_counts.get(student.id, 0) }}
              </span>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="card-panel blue lighten-5 hours-empty-state">
      <span class="grey-text text-darken-2">
        No students found for the selected filters.
      </span>
    </div>
  {% endif %}
</div>
{% endblock %}
